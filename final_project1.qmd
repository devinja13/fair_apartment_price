---
title: "Apartment Regression"
format: pdf
editor: visual
---

Libraries

```{r, echo=TRUE}

library(data.table)
library(dplyr)
library(stringr)


```

```{r}
data <- read.csv2("apartments.csv")



```

Data Cleaning

```{r}

unique(data$currency)

cleaned <- data %>%
              filter(currency == "USD", price_type == "Monthly", nchar(state) == 2, bathrooms != "null", !bedrooms %in% c("null", "USD", "") ) %>%
              mutate(pets_allowed = ifelse(pets_allowed %in% c("Cats", "Dogs", "Cats, Dogs", "Cats, Dogs, None"), 1, 0)) %>%
              mutate(has_photo = ifelse(has_photo %in% c("Thumbnail", "Yes"), 1, 0)) %>%
              mutate(fee = ifelse(fee == "Yes", 1, 0))
  

# I was exploring the data
unique(data$category)

unique(data$amenities)

unique(data$pets_allowed)

unique(data$has_photo)

unique(data$price_type)
unique(data$fee)
unique(data$cityname)
sd(data$time, na.rm=TRUE)

#cleaning pets

pet_test <- cleaned[!cleaned$pets_allowed %in% c("Cats", "Dogs", "Cats, Dogs", "None", "Cats, Dogs, None", "Cats,Dogs"), ]

#delete the amenities, title, body columns, id, pets_allowed, latitude,
# longitude, currency, citynames(too many), price_display, price_type, 
#address, cityname, source, maybe time

#Columns that should be factors
#category, pets_allowed, has_photo, fee, state


cleaned$category <- as.factor(cleaned$category)
cleaned$pets_allowed <- as.factor(cleaned$pets_allowed)
cleaned$has_photo <- as.factor(cleaned$has_photo)
cleaned$fee <- as.factor(cleaned$fee)
cleaned$state <- as.factor(cleaned$state)



```

Adding the city population and density to the data
```{r, echo=TRUE}

cities <- read.csv("uscities.csv")

cleaned <- cleaned %>%
  mutate(city = tolower(cityname), state = tolower(state))
cities <- cities %>%
  mutate(city = tolower(city), state = tolower(state_id))

cleaned <- cleaned %>%
  mutate(city = trimws(city), state = trimws(state))
cities <- cities %>%
  mutate(city = trimws(city), state = trimws(state))


data <- cleaned %>%
  left_join(cities %>% select(city, state, population, density), 
            by = c("city", "state"))

#can do either median or mean. 
pop_mean <- (mean(cities$population, na.rm=TRUE))

density_med <- mean(cities$density, na.rm=TRUE)

cleaned <- mutate(data, population = ifelse(is.na(population), pop_mean, population), density = ifelse(is.na(density), density_med, density))

```


1.  If we want we could create categorical variables for each of the ammenitites like AC, fridge, gym, basketball, etc

Getting the data

```{r}

Y <- cleaned$square_feet

x <- select(cleaned, as.numeric(bathrooms), bedrooms, fee, has_photo, pets_allowed, price)



```

Correlation Matrix

```{r}

cor(x)

```
